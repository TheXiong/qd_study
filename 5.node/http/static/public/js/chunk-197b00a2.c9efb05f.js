(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-197b00a2"],{"268fb":function(e,t,r){},a1cb:function(e,t,r){"use strict";r.r(t);r("7f7f"),r("a481");var n=r("f499"),a=r.n(n),o=r("f095"),i=r("7026"),l=r.n(i),s=(r("542c"),{name:"Role",components:{treeSelect:l.a},data:function(){return{roleList:[],listLoading:!1,multipleSelection:[],dialogFormVisible:!1,formLabelWidth:"120px",rules:{parent:[{required:!0,message:"请选择上级",trigger:"blur"}],alias:[{required:!0,message:"请输入名称",trigger:"blur"}],rules:[],status:[]},options:[],form:{parent:"",alias:"",rules:[]},vv:this.$store.getters.vv,is_root:this.$store.getters.is_root,ruleData:[],ruleLoading:!1,defaultProps:{children:"children",label:"name"}}},created:function(){this.formCopy=JSON.parse(a()(this.form))},mounted:function(){this.getRoleData()},methods:{ruleCheckedChanged:function(e,t){-1!==t.checkedKeys.indexOf(e.id)?(this.setParentChecked(e,!0),this.setChildrenChecked(e,!0)):this.setChildrenChecked(e,!1)},setParentChecked:function(e,t){e.parent&&void 0!==e.parent&&(this.$refs.menuTree.setChecked(e.parent,t,!0),this.setParentChecked(this.$refs.menuTree.getNode(e.parent),t))},setChildrenChecked:function(e,t){if(e.children&&e.children.length>0)for(var r=0;r<e.children.length;r++)this.$refs.menuTree.setChecked(e.children[r].id,t,!0),this.setChildrenChecked(e.children[r],t)},getRoleData:function(){var e=this;this.listLoading=!0,Object(o.m)().then(function(t){for(var r=t.data.data.data,n=0;n<r.length;n++)r[n].alias=r[n].alias.replace(r[n].spacer+" ","");e.roleList=r.filter(function(e,t){return 0===e.status}),e.options=e.generateOption(r),e.form.parent=e.options[0].id,e.listLoading=!1}),this.generateRuleData()},parentChange:function(e,t){""!==e&&this.generateRuleData(e)},handleClose:function(e){this.resetForm(),e()},closeForm:function(){this.resetForm()},resetForm:function(){this.dialogFormVisible=!1,this.$refs.ruleForm.resetFields(),this.$refs.menuTree.setCheckedKeys([]),this.form=JSON.parse(a()(this.formCopy))},addOrUpdateRole:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.form.rules=t.$refs.menuTree.getCheckedKeys().filter(function(e,t){return e>0})||[],(t.form.vv?Object(o.p)(t.form):Object(o.c)(t.form)).then(function(e){t.$message({showClose:!0,message:e.data.msg,type:"success"}),t.resetForm(),t.getRoleData()})})},editRole:function(e,t){var r=this;Object(o.l)({vv:e}).then(function(e){var t=e.data.data;for(var n in r.form)r.form[n]=t.row[n];r.form.vv=t.row.vv});var n=this.walkOption(this.roleList,e),a=this.roleList.filter(function(e,t){return-1==n.indexOf(t)});this.options=this.generateOption(a),this.dialogFormVisible=!0},deleteRoleById:function(e){var t=this;this.$confirm("你确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(o.h)({vv:e}).then(function(e){t.$message({showClose:!0,message:e.data.msg,type:"success"}),t.getRoleData()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},generateRuleData:function(e){var t=this;Object(o.k)({vv:e||null}).then(function(e){var r=e.data.data.data;for(var n in r)for(var a=0;a<r[n].length;a++)r[n][a].name=r[n][a].name.replace(r[n][a].spacer+" ","");r[0]=r[0]?r[0]:[],r[1]=r[1]?r[1]:[],t.ruleData=[{id:0,name:"PC端",children:t.generateRuleTree(r[0])},{id:-1,name:"app端",children:t.generateRuleTree(r[1])}]})},generateOption:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=0;r<e.length;r++)t[r]={},t[r].id=e[r].id,t[r].label=" "+e[r].spacer+" "+e[r].alias;return t},generateRuleTree:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=0;r<e.length;r++)t[r]={},t[r].id=e[r].id,t[r].parent=e[r].parent,t[r].name=e[r].name;return this.getTree(t)},walkOption:function(e,t){var r=[];!function t(n){for(var a=0;a<e.length;a++){var o=e[a];o.parent==n&&(t(o.id),r.push(a))}}(t);for(var n=0;n<e.length;n++)e[n].vv==t&&r.push(n);return r},getTree:function(e){return function t(r){for(var n=[],a=0;a<e.length;a++){var o=e[a];o.parent==r&&(o.children=t(o.id),n.push(o))}return n}(0)}}}),c=(r("a5db"),r("2877")),d=Object(c.a)(s,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("div",{staticClass:"filter-container"},[r("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("添加")])],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.roleList,"tooltip-effect":"dark",border:"",fit:""}},[r("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.$index+1))]}}])}),r("el-table-column",{attrs:{prop:"alias",align:"center",label:"名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"role_name",domProps:{innerHTML:e._s(" "+t.row.spacer+" "+t.row.alias)}})]}}])}),r("el-table-column",{attrs:{label:"操作",align:"center",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[0!==t.row.company||"1"===e.is_root?r("el-button",{attrs:{type:"info",icon:"el-icon-edit"},on:{click:function(r){return e.editRole(t.row.vv,t.row.parent)}}},[e._v("编辑")]):e._e(),0!==t.row.company||"1"===e.is_root?r("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(r){return e.deleteRoleById(t.row.vv)}}},[e._v("删除")]):e._e()]}}])})],1),r("el-dialog",{attrs:{title:e.form.vv?"编辑职位":"新增职位",visible:e.dialogFormVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[r("el-form-item",{attrs:{label:"上级","label-width":e.formLabelWidth,prop:"parent"}},[r("treeSelect",{attrs:{multiple:!1,options:e.options},on:{input:e.parentChange},scopedSlots:e._u([{key:"value-label",fn:function(t){var n=t.node;return r("div",{domProps:{innerHTML:e._s(n.label)}})}},{key:"option-label",fn:function(t){var n=t.node;return r("label",{},[r("span",{domProps:{innerHTML:e._s(n.label)}})])}}]),model:{value:e.form.parent,callback:function(t){e.$set(e.form,"parent",t)},expression:"form.parent"}})],1),r("el-form-item",{attrs:{label:"名称","label-width":e.formLabelWidth,prop:"alias"}},[r("el-input",{attrs:{autocomplete:"off",maxlength:"64","show-word-limit":""},model:{value:e.form.alias,callback:function(t){e.$set(e.form,"alias",t)},expression:"form.alias"}})],1),r("el-form-item",{attrs:{label:"权限","label-width":e.formLabelWidth,prop:"rules"}},[r("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.ruleLoading,expression:"ruleLoading"}],ref:"menuTree",staticStyle:{width:"100%","pading-top":"20px"},attrs:{data:e.ruleData,size:"mini","show-checkbox":"","node-key":"id",props:e.defaultProps,"element-loading-text":"拼命加载中","default-expanded-keys":[0,-1],"check-strictly":!0,"default-checked-keys":e.form.rules},on:{check:e.ruleCheckedChanged}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.closeForm}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addOrUpdateRole("ruleForm")}}},[e._v("确 定")])],1)],1)],1)},[],!1,null,"0ca1e74a",null);t.default=d.exports},a5db:function(e,t,r){"use strict";var n=r("268fb");r.n(n).a}}]);