(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d0c515c"],{"3e1e":function(e,t,o){"use strict";o.r(t);o("7f7f");var r=o("e814"),a=o.n(r),n=(o("28a5"),o("f499")),l=o.n(n),i=(o("a481"),o("cebc")),s=(o("3b2b"),o("70d8")),c=(o("f095"),o("61f7")),u=o("333d"),m=o("7026"),d=o.n(m),f=(o("542c"),{name:"Admin",components:{Pagination:u.a,treeSelect:d.a},data:function(){return{adminList:[],companyList:[{vv:2,name:"ds"}],jobList:[],genderMap:{1:"男",2:"女"},statusMap:{0:"正常",1:"冻结",2:"封号"},rolesError:"",dialogFormVisible:!1,formLabelWidth:"120px",rules:{name:[{required:!0,trigger:"blur",validator:function(e,t,o){var r=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]");t?r.test(t)?o(new Error("姓名不允许包含特殊字符")):t.length>32?o(new Error("姓名不允许超过32字符")):o():o(new Error("姓名不能为空"))}}],nick:[],gender:[],mobile:[{required:!0,trigger:"blur",validator:function(e,t,o){return Object(c.b)(t)?o():o(new Error("请输入正确的手机号码")),o()}}],password:[{required:!0,validator:function(e,t,o){t.length<6||t.length>18?o(new Error("密码必须在6~18位之间")):o()},trigger:"blur"}],company:[],job:[],roles:[]},options:[],form:{name:"",nick:"",gender:"",mobile:"",password:"",company:"",job:"",roles:[],status:""},roleData:[],roleLoading:!1,menuSelections:[],authLoading:!1,checkAll:!1,currentRoleMenus:[],defaultProps:{children:"children",label:"name"},listLoading:!1,total:0,listQuery:{page:1,limit:10,search:null},searchRule:{search:[{required:!1,validator:function(e,t,o){if(t){/^[0-9]+$/.test(t)&&t.length>=3?o():o(new Error("请至少输入3位电话号码"))}else o()},trigger:"blur"}]}}},created:function(){this.formCopy=Object(i.a)({},this.form,{company:this.$store.getters.company})},mounted:function(){this.getList()},methods:{getCompanys:function(e){var t=this;Object(s.f)({vv:e}).then(function(e){1===e.data.data.data.length&&(t.form.company=e.data.data.data[0].vv,t.getJobs(t.form.company),t.getRoles(t.form.company)),t.companyList=e.data.data.data}).catch(function(e){t.companyList=[]})},getJobs:function(e){var t=this;Object(s.g)({company:e}).then(function(e){t.options=t.generateOption(e.data.data.data)}).catch(function(e){t.options=[],t.form.job=""})},getRoles:function(e){var t=this;Object(s.h)({company:e}).then(function(e){for(var o=e.data.data.data,r=0;r<o.length;r++)o[r].alias=o[r].alias.replace(o[r].spacer+" ","");t.roleData=t.generateRuleTree(o,o[0].parent)}).catch(function(e){t.roleData=[],t.form.roles=[]})},selectCompany:function(e){this.getJobs(e),this.getRoles(e)},paginationChange:function(e){this.getList()},search:function(){var e=this;this.$refs.searchForm.validate(function(t){t&&e.getList()})},reset:function(){this.listQuery.search=null,this.getList()},getList:function(){var e=this;this.listLoading=!0,Object(s.e)(this.listQuery).then(function(t){0==t.data.data.data.length&&e.listQuery.page>1?(e.listQuery.page--,e.getList()):(e.adminList=t.data.data.data,e.total=t.data.data.total,e.listLoading=!1)}),this.getCompanys(this.$store.getters.vv)},handleClose:function(e){this.resetForm(),e()},closeForm:function(e){this.resetForm()},resetForm:function(){this.dialogFormVisible=!1,this.$refs.ruleForm.resetFields(),this.form=JSON.parse(l()(this.formCopy));try{this.$refs.roleTree.setCheckedNodes([])}catch(e){}},addOrUpdateAdmin:function(e){var t=this;this.form.roles=this.form.company&&this.$refs.roleTree.getCheckedKeys()||[],this.form.job=this.form.job||"",this.$refs[e].validate(function(e){if(!e)return!1;(t.form.vv?Object(s.i)(t.form):Object(s.a)(t.form)).then(function(e){t.$message({showClose:!0,message:e.data.msg,type:"success"}),t.resetForm(),t.getList()})})},editAdmin:function(e){var t=JSON.parse(l()(this.form));for(var o in t)t[o]="roles"==o?e[o]?e[o].split(",").map(function(e,t){return a()(e)}):[]:"password"==o?"":"status"==o?e[o]+"":e[o];this.getCompanys(e.vv),t.company&&(this.getJobs(t.company),this.getRoles(t.company)),t.vv=e.vv,this.form=t,this.dialogFormVisible=!0},deleteAdminById:function(e){var t=this;this.$confirm("你确定要让该用户离职吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.d)({vv:e}).then(function(e){t.$message({showClose:!0,message:e.data.msg,type:"success"}),t.getList()})}).catch(function(){t.$message({type:"info",message:"已取消操作"})})},generateRuleTree:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=0;r<e.length;r++)o[r]={},o[r].id=e[r].id,o[r].parent=e[r].parent,o[r].name=e[r].alias;return this.getTree(o,t)},getTree:function(e,t){return function t(o){for(var r=[],a=0;a<e.length;a++){var n=e[a];n.parent==o&&(n.children=t(n.id),r.push(n))}return r}(t)},generateOption:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=0;o<e.length;o++)t[o]={},t[o].id=e[o].id,t[o].label=" "+e[o].spacer+" "+e[o].name;return t}}}),p=o("2877"),h=Object(p.a)(f,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"app-container"},[o("div",{staticClass:"filter-container"},[o("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("添加用户")])],1),o("div",{staticClass:"filter-container"},[o("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.listQuery,rules:e.searchRule},nativeOn:{submit:function(e){e.preventDefault()}}},[o("el-form-item",{attrs:{label:"姓名或电话"}},[o("el-input",{model:{value:e.listQuery.search,callback:function(t){e.$set(e.listQuery,"search",t)},expression:"listQuery.search"}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")]),o("el-button",{attrs:{type:"primary"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.adminList,"tooltip-effect":"dark",border:"",fit:""}},[o("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s((e.listQuery.page-1)*e.listQuery.limit+t.$index+1))]}}])}),o("el-table-column",{attrs:{prop:"name",align:"center",label:"姓名","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.name))]}}])}),o("el-table-column",{attrs:{prop:"gender",align:"center",label:"性别",width:"80","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("genderFormat")(t.row.gender)))]}}])}),o("el-table-column",{attrs:{prop:"mobile",align:"center",label:"手机号","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.mobile))]}}])}),o("el-table-column",{attrs:{prop:"com_name",align:"center",label:"所属机构","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.com_name))]}}])}),o("el-table-column",{attrs:{prop:"job_name",align:"center",label:"部门","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.job_name))]}}])}),o("el-table-column",{attrs:{prop:"role_names",align:"center",label:"职位","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.role_names?t.row.role_names.split(","):[],function(t){return o("el-tag",{key:t,attrs:{type:"info"}},[e._v(e._s(t))])})}}])}),o("el-table-column",{attrs:{prop:"status",align:"center",label:"状态",width:"100","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?o("span",[e._v("正常")]):e._e(),1==t.row.status?o("span",[e._v("冻结")]):e._e(),2==t.row.status?o("span",[e._v("封号")]):e._e(),-1==t.row.status?o("span",[e._v("删除")]):e._e()]}}])}),o("el-table-column",{attrs:{label:"操作",align:"center",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"info",icon:"el-icon-edit"},on:{click:function(o){return e.editAdmin(t.row)}}},[e._v("编辑")]),o("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(o){return e.deleteAdminById(t.row.vv)}}},[e._v("离职")])]}}])})],1),o("el-dialog",{attrs:{title:e.form.vv?"编辑人员":"新增人员",visible:e.dialogFormVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[o("el-form-item",{attrs:{label:"姓名","label-width":e.formLabelWidth,prop:"name"}},[o("el-input",{attrs:{type:"text",maxlength:"9","show-word-limit":""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),o("el-form-item",{attrs:{label:"昵称","label-width":e.formLabelWidth,prop:"nick"}},[o("el-input",{attrs:{type:"text",maxlength:"9","show-word-limit":""},model:{value:e.form.nick,callback:function(t){e.$set(e.form,"nick",t)},expression:"form.nick"}})],1),o("el-form-item",{attrs:{label:"性别","label-width":e.formLabelWidth,prop:"gender"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},e._l(e.genderMap,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),o("el-form-item",{attrs:{label:"电话号码","label-width":e.formLabelWidth,prop:"mobile"}},[o("el-input",{attrs:{type:"text",maxlength:"11","show-word-limit":"",readonly:"",onfocus:"this.removeAttribute('readonly')"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1),o("el-form-item",{attrs:{label:"密码","label-width":e.formLabelWidth,prop:e.form.vv?"":"password"}},[o("el-input",{attrs:{type:"password",readonly:"",onfocus:"this.removeAttribute('readonly')"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),o("el-form-item",{attrs:{label:"所属机构","label-width":e.formLabelWidth,prop:"company"}},[o("el-select",{attrs:{disabled:1!=e.$store.getters.is_root,filterable:"",placeholder:"请选择"},on:{change:e.selectCompany},model:{value:e.form.company,callback:function(t){e.$set(e.form,"company",t)},expression:"form.company"}},e._l(e.companyList,function(e){return o("el-option",{key:e.vv,attrs:{label:e.name,value:e.vv}})}),1)],1),e.form.company?o("el-form-item",{attrs:{label:"部门","label-width":e.formLabelWidth,prop:"job"}},[o("treeSelect",{attrs:{multiple:!1,options:e.options},scopedSlots:e._u([{key:"value-label",fn:function(t){var r=t.node;return o("div",{domProps:{innerHTML:e._s(r.label)}})}},{key:"option-label",fn:function(t){var r=t.node;return o("label",{},[o("span",{domProps:{innerHTML:e._s(r.label)}})])}}]),model:{value:e.form.job,callback:function(t){e.$set(e.form,"job",t)},expression:"form.job"}})],1):e._e(),e.form.company?o("el-form-item",{attrs:{label:"职位","label-width":e.formLabelWidth,error:e.rolesError,prop:"roles"}},[o("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.roleLoading,expression:"roleLoading"}],ref:"roleTree",staticStyle:{width:"100%","pading-top":"20px"},attrs:{data:e.roleData,size:"mini","show-checkbox":"","default-expand-all":"","node-key":"id",props:e.defaultProps,"element-loading-text":"拼命加载中","default-checked-keys":e.form.roles,"check-strictly":""}})],1):e._e(),o("el-form-item",{attrs:{label:"状态","label-width":e.formLabelWidth,prop:"status"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.statusMap,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){return e.closeForm("ruleForm")}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addOrUpdateAdmin("ruleForm")}}},[e._v("确 定")])],1)],1),o("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{"update:page":function(t){return e.$set(e.listQuery,"page",t)},"update:limit":function(t){return e.$set(e.listQuery,"limit",t)},pagination:e.paginationChange}})],1)},[],!1,null,null,null);t.default=h.exports}}]);