(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-cfcd7b44"],{"401f":function(t,e,a){},"5f52":function(t,e,a){},"5f7c":function(t,e,a){"use strict";a.r(e);var s=a("75fc"),i=(a("7f7f"),a("cebc")),n=a("f499"),r=a.n(n),o=a("b39f"),l=a("0ced"),c={props:["chatData","noMoreChat"],data:function(){return{isFetch:!1,loading:!0,prevScrollHeight:0,transferIndex:null,contextMenuData:{menuName:"demo",axis:{x:null,y:null},menulists:[{btnName:"提醒",fnHandler:"HandlerNotify"},{btnName:"撤回",fnHandler:"HandlerCancel"}]},dialogVisible:!1,remindDay:"",contextMenuItem:""}},watch:{chatData:function(t){var e=this;this.$nextTick(function(){e.isFetch=!1;var t=document.querySelector(".message-wraper");t.scrollTop=t.scrollHeight-e.prevScrollHeight,t.addEventListener("scroll",function(a){a=a||window.event;0==t.scrollTop&&(e.isFetch||(e.$emit("scroll-top"),e.isFetch=!0,e.prevScrollHeight=t.scrollHeight))})})}},methods:{showMenu:function(t){this.transferIndex=t,event.preventDefault();var e=event.clientX,a=event.clientY;this.contextMenuData.axis={x:e,y:a},this.chatData[t].remind_day?this.contextMenuData.menulists=[{btnName:"取消提醒",fnHandler:"HandlerNotifyDel"},{btnName:"撤回",fnHandler:"HandlerCancel"}]:this.contextMenuData.menulists=[{btnName:"提醒",fnHandler:"HandlerNotify"},{btnName:"撤回",fnHandler:"HandlerCancel"}],this.contextMenuItem=this.chatData[t]},HandlerNotify:function(t){this.dialogVisible=!0},HandlerCancel:function(t){this.$emit("back",this.chatData[t].vv)},refresh:function(){this.prevScrollHeight=0},handleClose:function(t){t()},close:function(){this.remindDay="",this.dialogVisible=!1},addRemind:function(){/^\d+$/.test(this.remindDay)&&+this.remindDay>0?(this.$emit("remind",this.contextMenuItem.vv,this.remindDay),this.remindDay="",this.dialogVisible=!1):this.$message({showClose:!0,message:"提醒时间必须为正整数",type:"error"})},HandlerNotifyDel:function(){this.$emit("remindDel",this.contextMenuItem.remind_vv)}}},d=(a("9ee5"),a("2877")),u=Object(d.a)(c,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"message-container"},[a("div",{staticClass:"message-wraper"},[t.noMoreChat?a("div",{staticClass:"loadMore"},[t._v("没有更多数据")]):a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"loadMore"}),t._l(t.chatData,function(e,s){return a("div",{key:s,staticClass:"item"},[a("div",{staticClass:"time"},[t._v(t._s(t._f("timeStampFormat")(e.insert_timestamp)))]),2==e.direction?a("div",{staticClass:"message-not-self"},[a("div",{staticClass:"avatar"},[a("img",{attrs:{src:e.u_uri,alt:"",srcset:""}})]),a("div",{staticClass:"content"},[a("div",{staticClass:"name"},[t._v(t._s(e.u_name))]),a("div",{staticClass:"msg",on:{contextmenu:function(e){return t.showMenu(s)}}},[a("div",{staticClass:"des"},[t._v(t._s(e.describe))]),e.remind_time&&e.remind_time>Math.round((new Date).getTime()/1e3)?a("div",{staticClass:"remind_day"},[t._v(t._s("您已设置"+new Date(parseInt(1e3*e.remind_time)).toLocaleString().split(" ")[0]+"提醒"))]):t._e()])])]):a("div",{staticClass:"message-self"},[a("div",{staticClass:"content"},[a("div",{staticClass:"name"},[t._v(t._s(e.u_name))]),a("div",{staticClass:"msg",on:{contextmenu:function(e){return t.showMenu(s)}}},[a("div",{staticClass:"des"},[t._v(t._s(e.describe))]),e.remind_time&&e.remind_time>Math.round((new Date).getTime()/1e3)?a("div",{staticClass:"remind_day"},[t._v(t._s("您已设置"+new Date(parseInt(1e3*e.remind_time)).toLocaleString().split(" ")[0]+"提醒"))]):t._e()])]),a("div",{staticClass:"avatar"},[a("img",{attrs:{src:e.u_uri,alt:"",srcset:""}})])]),a("vue-context-menu",{attrs:{contextMenuData:t.contextMenuData,transferIndex:t.transferIndex},on:{HandlerNotifyDel:function(e){return t.HandlerNotifyDel(s)},HandlerNotify:function(e){return t.HandlerNotify(s)},HandlerCancel:function(e){return t.HandlerCancel(s)}}})],1)}),t.dialogVisible?a("div",{staticClass:"remind-time"},[a("span",{staticClass:"close",on:{click:t.close}},[t._v("x")]),a("div",{staticClass:"input"},[t._v("\n        设置\n        "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.remindDay,expression:"remindDay"}],attrs:{type:"text"},domProps:{value:t.remindDay},on:{input:function(e){e.target.composing||(t.remindDay=e.target.value)}}}),t._v("天后提醒\n      ")]),a("div",{staticClass:"btn"},[a("el-button",{attrs:{size:"mini"},on:{click:t.addRemind}},[t._v("确 定")])],1)]):t._e()],2)])},[],!1,null,"879990c8",null).exports,h=a("333d"),m={components:{VDistpicker:l.a,Pagination:h.a,chatBox:u},data:function(){var t=this;return{is_leader:this.$store.getters.is_leader,type:"my",tableData:[],total:0,listQuery:{page:1,limit:10},chatListQuery:{page:1,limit:10},chatData:[],chatDataTotal:0,noMoreChat:!1,editRow:null,searchForm:{search:"",lowest_budget:"",highest_budget:"",province:"",city:"",county:""},searchOther:[],searchConf:[],searchRules:{lowest_budget:[{validator:function(e,a,s){a||t.form.lowest_budget||s(),a||s(new Error("请输入最低预算")),/^(\-){0,1}(([1-9][0-9]*|0)|(([1-9][0-9]*|0)\.[0-9]+))$/.test(a)||s(new Error("请输入数字")),t.form.highest_budget&&a>t.form.highest_budget&&s(new Error("最高预算不能低于最低预算")),s()},trigger:"blur"}],highest_budget:[{validator:function(e,a,s){a||t.form.lowest_budget||s(),a||s(new Error("请输入最高预算")),/^(\-){0,1}(([1-9][0-9]*|0)|(([1-9][0-9]*|0)\.[0-9]+))$/.test(a)||s(new Error("请输入数字")),t.form.lowest_budget&&a<t.form.lowest_budget&&s(new Error("最高预算不能低于最低预算")),s()},trigger:"blur"}]},showFilter:!1,followMsg:""}},mounted:function(){this.searchFormCopy=JSON.parse(r()(this.searchForm)),this.getList(),this.getConf()},methods:{getList:function(){var t=this;Object(o.i)(Object(i.a)({type:this.type},this.listQuery,this.searchForm,{conf:this.searchConf})).then(function(e){0==e.data.data.data.lists.length&&t.listQuery.page>1?(t.listQuery.page--,t.getList()):(t.tableData=e.data.data.data.lists,t.editRow=t.tableData[0]?t.tableData[0]:null,t.total=e.data.data.data.total,t.getLog())})},getConf:function(){var t=this;Object(o.h)({type:1}).then(function(e){for(var a=e.data.data.data,s=[],i=0;i<a.length;i++){var n={};n.id=a[i].id,n.name=a[i].name,n.options=a[i].options,n.children=a[i].children,n.priority=a[i].priority,n.value=[],s.push(n)}t.searchOther=s,t.searchOtherCopy=JSON.parse(r()(t.searchOther))})},query:function(){var t=this;this.$refs.searchForm.validate(function(e){if(e){for(var a=[],i=function(e){if(t.searchOther[e].value.length>0){var i=t.searchOther[e].children.filter(function(a,s){return-1!==t.searchOther[e].value.indexOf(a.id)}).map(function(t,e){return t.id});a.push.apply(a,Object(s.a)(i))}},n=0;n<t.searchOther.length;n++)i(n);t.listQuery={page:1,limit:10},t.searchConf=a,t.getList()}})},reset:function(){this.listQuery={page:1,limit:10},this.searchConf=[],this.searchForm=JSON.parse(r()(this.searchFormCopy)),this.searchOther=JSON.parse(r()(this.searchOtherCopy)),this.getList()},typeChange:function(t){this.getList()},paginationChange:function(t){this.getList()},handleEdit:function(t,e){this.chatListQuery={page:1,limit:10},this.editRow=e,this.$refs.chat.refresh(),this.getLog()},getLog:function(){var t=this;this.editRow+""!="null"?Object(o.j)(Object(i.a)({customer:this.editRow.vv},this.chatListQuery)).then(function(e){t.chatData=e.data.data.data.lists.map(function(e){return e.direction=e.operator==t.$store.getters.vv?1:2,e}),t.chatDataTotal=e.data.data.data.total,t.chatData.length<t.chatListQuery.limit?t.noMoreChat=!0:t.noMoreChat=!1}):(this.chatData=[],this.chatDataTotal=0,this.noMoreChat=!0)},districtSelected:function(t,e,a){"province"==e?(this[a][e]=t.code,this[a].city="",this[a].county=""):"city"==e?(this[a][e]=t.code,this[a].county=""):this[a][e]=t.code},sendFollowMsg:function(){var t=this;""!=this.followMsg?Object(o.b)({customer:this.editRow.vv,title:"",describe:this.followMsg,note:"",class:"",uri:""}).then(function(e){t.followMsg="",t.$refs.chat.refresh(),t.chatListQuery={page:1,limit:10},t.getLog()}):this.$message({showClose:!0,message:"跟进消息不能为空",type:"error"})},scrollTop:function(){var t=this;this.noMoreChat||Object(o.j)(Object(i.a)({customer:this.editRow.vv},this.chatListQuery,{page:this.chatListQuery.page+1})).then(function(e){var a=e.data.data.data.lists,i=JSON.parse(r()(t.chatData));a.push.apply(a,Object(s.a)(i)),t.chatData=a.map(function(e){return e.direction=e.operator==t.$store.getters.vv?1:2,e}),t.chatListQuery.page=t.chatListQuery.page+1,t.chatListQuery.page*t.chatListQuery.limit>t.chatDataTotal&&(t.noMoreChat=!0)})},backMsg:function(t){var e=this;this.$confirm("你确定要撤回该消息吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(o.e)({vv:t}).then(function(t){e.$message({showClose:!0,message:t.data.msg,type:"success"}),e.$refs.chat.refresh(),e.chatListQuery={page:1,limit:10},e.getLog()})}).catch(function(){e.$message({type:"info",message:"已取消操作"})})},remind:function(t,e){var a=this;Object(o.c)({vv:t,day:e}).then(function(e){a.$message({showClose:!0,message:e.data.msg,type:"success"});for(var s=JSON.parse(r()(a.chatData)),n=0;n<s.length;n++)s[n].vv==t&&(s[n]=Object(i.a)({},s[n],e.data.data.data));a.chatData=s})},remindDel:function(t){var e=this;Object(o.f)({remind_vv:t}).then(function(a){e.$message({showClose:!0,message:a.data.msg,type:"success"});for(var s=JSON.parse(r()(e.chatData)),i=0;i<s.length;i++)s[i].remind_vv==t&&(s[i].remind_day=null,s[i].remind_time=null,s[i].remind_vv=null);e.chatData=s})}}},f=(a("de47"),Object(d.a)(m,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[t.showFilter?a("div",{staticClass:"filter-container"},[a("el-form",{ref:"searchForm",attrs:{inline:!0,rules:t.searchRules,model:t.searchForm}},[a("el-form-item",{attrs:{label:"姓名/电话",prop:"name"}},[a("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:t.searchForm.search,callback:function(e){t.$set(t.searchForm,"search",e)},expression:"searchForm.search"}})],1),a("el-form-item",{staticClass:"area",attrs:{label:"区域",prop:"county"}},[a("v-distpicker",{attrs:{province:t.searchForm.province,city:t.searchForm.city,area:t.searchForm.county},on:{province:function(e){return t.districtSelected(e,"province","searchForm")},city:function(e){return t.districtSelected(e,"city","searchForm")},area:function(e){return t.districtSelected(e,"county","searchForm")}}})],1),a("el-form-item",{staticClass:"budget",attrs:{label:"预算"}},[a("el-form-item",{attrs:{prop:"lowest_budget"}},[a("el-input",{model:{value:t.searchForm.lowest_budget,callback:function(e){t.$set(t.searchForm,"lowest_budget",e)},expression:"searchForm.lowest_budget"}}),t._v("万~\n        ")],1),a("el-form-item",{attrs:{prop:"highest_budget"}},[a("el-input",{model:{value:t.searchForm.highest_budget,callback:function(e){t.$set(t.searchForm,"highest_budget",e)},expression:"searchForm.highest_budget"}}),t._v("万\n        ")],1)],1),t._l(t.searchOther,function(e,s){return a("el-form-item",{key:e.name,attrs:{label:e.name}},[a("el-select",{attrs:{placeholder:"请选择",multiple:""},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"item.value"}},t._l(e.children,function(t){return a("el-option",{key:t.id,attrs:{label:t.value,value:t.id}})}),1)],1)}),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.query}},[t._v("查询")]),a("el-button",{attrs:{type:"primary"},on:{click:t.reset}},[t._v("重置")])],1)],2)],1):t._e(),a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:12}},[a("el-card",{staticClass:"box-card"},[a("el-tabs",{on:{"tab-click":t.typeChange},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[a("el-tab-pane",{attrs:{label:"我的客户",name:"my"}}),t.is_leader?a("el-tab-pane",{attrs:{label:"下属客户",name:"subordinate"}}):t._e(),a("el-tab-pane",{attrs:{label:"公客池",name:"public"}})],1),a("el-button",{staticClass:"filter-btn",on:{click:function(e){t.showFilter=!t.showFilter}}},[t._v("筛选")]),a("el-table",{attrs:{data:t.tableData,"highlight-current-row":""}},[a("el-table-column",{key:1,attrs:{align:"center",label:"序号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s((t.listQuery.page-1)*t.listQuery.limit+e.$index+1))]}}])}),a("el-table-column",{key:2,attrs:{prop:"name",align:"center",label:"客户姓名"}}),"public"!==t.type?a("el-table-column",{key:3,attrs:{prop:"phone",align:"center",label:"报备电话"}}):t._e(),"subordinate"!==t.type?a("el-table-column",{key:4,attrs:{prop:"mobile",align:"center",label:"联系电话"}}):t._e(),a("el-table-column",{key:5,attrs:{align:"center",label:"客户标签"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.conf_zy?a("div",t._l(e.row.conf_zy.split(","),function(e,s){return a("el-tag",{key:s,attrs:{size:"medium"}},[t._v(t._s(e))])}),1):t._e()]}}])}),a("el-table-column",{key:6,attrs:{align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"medium"}},[t._v(t._s(e.row.status))])]}}])}),"my"!==t.type?a("el-table-column",{key:7,attrs:{align:"center",label:"所属"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.u_name+""=="null"?"公司公客池":e.row.u_name))]}}])}):t._e(),a("el-table-column",{key:8,attrs:{align:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"btn",attrs:{size:"mini"},on:{click:function(a){return t.handleEdit(e.$index,e.row)}}},[t._v("跟进")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.limit},on:{"update:page":function(e){return t.$set(t.listQuery,"page",e)},"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},pagination:t.paginationChange}})],1)],1),a("el-col",{attrs:{span:11}},[a("el-card",{staticClass:"box-card follow"},[a("div",{staticClass:"follow-wrap"},[a("div",{staticClass:"top"},[a("div",{staticClass:"title"},[t._v("客户资料")]),a("div",{staticClass:"client-detail"},[a("div",{staticClass:"personal"},[a("div",{staticClass:"avatar"},[t._v(t._s(t.editRow?t.editRow.name_cn_first:""))]),a("div",{staticClass:"info"},[a("div",{staticClass:"name-demand"},[a("div",{staticClass:"name"},[t._v(t._s(t.editRow?t.editRow.name:""))]),a("div",{staticClass:"demand"},[t.editRow&&t.editRow.conf_zy?t._l(t.editRow.conf_zy.split(","),function(e,s){return a("span",{key:s,staticClass:"client-tag"},[t._v(t._s(e))])}):t._e()],2)]),a("div",{staticClass:"phone"},[t._v(t._s(t.editRow?t.editRow.mobile?t.editRow.mobile:t.editRow.phone?t.editRow.phone:"":""))])]),a("div",{staticClass:"type"},[t._v(t._s(t.editRow?t.editRow.u_name?t.editRow.u_name+"的客户":"公司公客池":""))])]),a("div",{staticClass:"demand-more"},[t._v("需求描述:"+t._s(t.editRow?t.editRow.conf_cy:""))])])]),a("div",{staticClass:"bottom"},[a("div",{staticClass:"title"},[t._v("客户跟进记录")]),a("div",{staticClass:"chat-box"},[a("chat-box",{ref:"chat",attrs:{chatData:t.chatData,noMoreChat:t.noMoreChat},on:{"scroll-top":t.scrollTop,back:t.backMsg,remind:t.remind,remindDel:t.remindDel}})],1),a("div",{staticClass:"chat-input"},[a("el-input",{staticClass:"input",attrs:{type:"textarea",autosize:"",disabled:"subordinate"==t.type||!t.editRow,placeholder:"subordinate"==t.type?"下属客户不可跟进":"",maxlength:"200","show-word-limit":""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendFollowMsg(e)}},model:{value:t.followMsg,callback:function(e){t.followMsg=e},expression:"followMsg"}}),a("el-button",{staticClass:"btn",attrs:{type:"primary",disabled:"subordinate"==t.type||!t.editRow,plain:""},on:{click:t.sendFollowMsg}},[t._v("发送")])],1)])])])],1)],1)],1)},[],!1,null,"12213c8a",null));e.default=f.exports},"9ee5":function(t,e,a){"use strict";var s=a("401f");a.n(s).a},de47:function(t,e,a){"use strict";var s=a("5f52");a.n(s).a}}]);